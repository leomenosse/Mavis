<!DOCTYPE html>
<html>
<head>
  <title>Visualização - Mavis</title>
  <meta charset="utf-8">

  <!-- Arquivos CSS e JavaScript para o Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css" crossorigin=""/>  
  <script src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js" crossorigin=""></script>

  <!-- Arquivos para o plugin de zoom -->
  <link rel="stylesheet" type="text/css" href="/stylesheets/L.Control.ZoomBar.css"/>
  <script type="text/javascript" src="/javascripts/L.Control.ZoomBar.js"></script>

  <!-- Arquivo para o css da control bar -->
  <link rel="stylesheet" type="text/css" href="/stylesheets/L.Control.Bar.css" />
  <script src="/javascripts/L.Control.Bar.js"></script>

  <!-- Arquivos para o botão tela cheia -->
  <script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
  <link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet' />

  <!-- Configurações de estilo para o mapa se adequar ao tamanho da tela -->
  <meta name="viewport" content="width=device-width, maximum-scale=1.0, user-scalable=no"/>
  <style>
    body {
      padding: 0;
      margin: 0;
    }
    html, body, #mapDIV {
      /*
      height: 100%;
      width: 100vw;
      */
      height: 100%;
      width: 100%;
      margin: 0;
      padding: 0;
    }
    #getZoomButton {
      position: absolute;
      top: 10px;
      left: 50px;
      z-index: 1001;
      font-family: Impact, Charcoal, sans-serif;
      border-color: #000000;
      background-color: #f5f5f5;
    }
  </style>
</head>
<body>
  <div>
    <h3>Selecione os atributos que georeferenciam os dados</h3>
    <p>Latitude</p>
    <select>
      <% for(let i = 0; i < numericAttributes.length; i++) { %>
        <option value=<%=numericAttributes[i]%>><%=numericAttributes[i]%></option>
      <% } %>
    </select>
    <p>Longitude</p>
    <select>
      <% for(let i = 0; i < numericAttributes.length; i++) { %>
      <option value=<%=numericAttributes[i]%>><%=numericAttributes[i]%></option>
      <% } %>
    </select>

    <h3>Selecione um ou mais atributos para visualizar nos markers</h3>
    <form action="">
      <% for(let i = 0; i < textAttributes.length; i++) { %>
        <input type="checkbox" name="group1"> <%= textAttributes[i] %><br>
      <% } %>
    </form>

    <br>
    <h3>Selecione o atributo numérico utilizado para visualização de heatmap</h3>
    <form action="">
      <% for(let i = 0; i < numericAttributes.length; i++) { %>
      <input type="radio" name="group2"> <%= numericAttributes[i] %><br>
      <% } %>
    </form>

    <button>Confirmar</button>

  </div>
  <div id='mapDIV'></div>
  

  <!-- criando um botão para retornar as coordenadas do local atual -->
  <!--
  <button id="getZoomButton" onclick="getCenterAndZoom();">Ver Coordenadas Atuais</button>
  -->

  <!-- Plugins para o Heatmap -->
  <script src="/javascripts/leaflet-heat.js"></script>
  <!--<script src="http://leaflet.github.io/Leaflet.markercluster/example/realworld.10000.js"></script>-->
  <script src="/javascripts/exemploHeatmap.js"></script>

  <script>
    /* ================================= CRIAÇÃO DO MAPA ================================= */
    /* criando um objeto de mapa */
    var map = L.map(document.getElementById('mapDIV'), {
      center: [-41.29042, 174.78219],
      zoom: 8,
      zoomSnap: 0.9,
      zoomControl: false
    });

    /* adicionando o mapa base do OpenStreetMap */
    /* http://leaflet-extras.github.io/leaflet-providers/preview/ */
    var basemap = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
      attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>'
    });
    basemap.addTo(map);
    /* =================================================================================== */


    /* =============================== ADIÇÃO DE MARCADORES ============================== */
    /* criando o marcador com um título */
    var earthquakeMarker = L.marker([-20.1438, -44.1301], {
      title: 'Janeiro 25, 2019 Desastre de Brumadinho'
    });
    /* adicionando um pop-up ao marcador */
    earthquakeMarker.bindPopup("Janeiro 25, 2019 Desastre de Brumadinho");
    /* adicionando-o ao mapa */
    earthquakeMarker.addTo(map);
    /* =================================================================================== */


    /* ================================ ADIÇÃO DE OVERLAYS =============================== */
    /* Interesting places */
    var coolPlaces = new L.LayerGroup();

    L.marker([-41.29042, 174.78219]).bindPopup('Te Papa').addTo(coolPlaces),
    L.marker([-41.29437, 174.78405]).bindPopup('Embassy Theatre').addTo(coolPlaces),
    L.marker([-41.2895, 174.77803]).bindPopup('Michael Fowler Centre').addTo(coolPlaces),
    L.marker([-41.28313, 174.77736]).bindPopup('Leuven Belgin Beer Cafe').addTo(coolPlaces),
    L.polyline([
      [-41.28313, 174.77736],
      [-41.2895, 174.77803],
      [-41.29042, 174.78219],
      [-41.29437, 174.78405]
    ]).addTo(coolPlaces);
    /* ================== */

    /* HeatMap */
    addressPoints = addressPoints.map(  function(p) {
                                          return [p[0], p[1]]; 
                                        }
                                    );
    var heatmap = L.heatLayer(addressPoints/*, {
      radius: 6,
      blur: 8,
      maxZoom: 8
    }*/);
    /* ======= */

    var overlays = {
      "Interesting places": coolPlaces,
      "HeatMap": heatmap
    };
    /* =================================================================================== */


    /* ================================ ADIÇÃO DE BASEMAPS =============================== */
    /* criando duas novas camadas de blocos */
    var basetopo = L.tileLayer('https://api.maptiler.com/maps/darkmatter/{z}/{x}/{y}.png?key=ZKXT0rAu2s6WeJBxHZ4t', {
      attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>'
    });
    basetopo.addTo(map);

    var baserelief = L.tileLayer('https://api.maptiler.com/maps/topographique/{z}/{x}/{y}.jpg?key=ZKXT0rAu2s6WeJBxHZ4t', {
      attribution: '<a href="https://www.maptiler.com/copyright/" target="_blank">© MapTiler</a> <a href="https://www.openstreetmap.org/copyright" target="_blank">© OpenStreetMap contributors</a>'
    });
    baserelief.addTo(map);

    mapLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
    var BlackAndWhite = L.tileLayer('http://{s}.www.toolserver.org/tiles/bw-mapnik/{z}/{x}/{y}.png', {
      attribution: '&copy; ' + mapLink + ' Contributors',
      maxZoom: 18,
    }).addTo(map);

    mapLink = '<a href="http://openstreetmap.org">OpenStreetMap</a>';
    wholink ='<a href="http://stamen.com">Stamen Design</a>';
    var stamenWatercolor = L.tileLayer('http://{s}.tile.stamen.com/watercolor/{z}/{x}/{y}.jpg', {
      attribution: '&copy; '+mapLink+' Contributors & '+wholink,
      maxZoom: 18,
    }).addTo(map);

    mapLink = '<a href="http://www.esri.com/">Esri</a>';
    wholink = 'i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP,\
              and the GIS User Community';
    var Esri_World_Imagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServe\
      r/tile/{z}/{y}/{x}', {
      attribution: '&copy; '+mapLink+', '+wholink,
      maxZoom: 18,
    }).addTo(map);

    /* para permitir que o usuário escolha qual deles é exibido, criando um objeto para manter a descrição e a camada */
    var baselayers = {
      'Esri World Imagery': Esri_World_Imagery,
      'Stamen.Watercolor': stamenWatercolor,
      'Black and White': BlackAndWhite,
      'Topographique': baserelief,
      'Dark Matter': basetopo,
      'OpenStreetMap Standard': basemap
    };
    /* =================================================================================== */


    /* ================= ADIÇÃO DE BASEMAPS E OVERLAYS AO LAYERS CONTROL ================= */
    L.control.layers(baselayers,overlays).addTo(map);


    /* ======================== ADIÇÕES ÀS FUNCIONALIDADES DO MAPA ======================= */
    /* criando o ícone de zoom */
    var zoom_bar = new L.Control.ZoomBar({
      position: 'topleft'
    }).addTo(map);

    /* função para o botão retornar as coordenadas do local atual */
    function getCenterAndZoom(){
      alert("Latitude: "+map.getCenter().lat+"\nLongitude: "+map.getCenter().lng+"\nTamanho do Zoom: "+map.getZoom());
    }

    /* adicionando uma barra de escala (canto inferior esquerdo) */
    var scale = L.control.scale()
    scale.addTo(map);

    map.addControl(new L.Control.Fullscreen({
      title: {
          'false': 'View Fullscreen',
          'true': 'Exit Fullscreen'
      }
    }));
    /* =================================================================================== */

    
  </script>
</body>
</html>